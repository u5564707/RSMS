<html>
<head>
	<title>RSMS</title>
	<style>

	</style>
	<link rel="stylesheet" href="css/Treant.css">
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/tabulator.css">
	<link rel="stylesheet" href="css/jquery.contextMenu.min.css">
	<script src="js/raphael.js"></script>
    <script src="js/Treant.js"></script>



	</head>
	<body>
		<div class="chart" id="tree"></div>
		<div id="samples-table"></div>
		<script src="js/jquery-2.2.4.min.js" type="text/javascript"></script>
		<script src="js/jquery-ui-1.11.4/jquery-ui.min.js" type="text/javascript"></script>
		<script src="js/jquery.contextMenu.min.js" type="text/javascript"></script>
		<script src="js/tabulator.js" type="text/javascript"></script>
		<script src="databaseFunctions.js" type="text/javascript"></script>
		<script>

		// load up required modules

		createDummyDatastore(); // for testing

		// initialise tree structure
		getNode("rootNode", function (rootNode) {
		    getChildNodes(rootNode._id, function(childNodes) {
		        
		        // define root node's children
		        var children = [];
		        for (i=0; i<childNodes.length; i++) {
		            var child = {
			            text: { name: childNodes[i]._id },
			            HTMLid: childNodes[i]._id,
			            HTMLclass: "sampleset"
		            }
		            children.push(child);
		        }
		        
		        // define tree (only trees of depth 2 for now)
		        var chart_config = {
			        chart: {
				        container: "#tree"
			        },
			        nodeStructure: {
			            text: { name: rootNode._id },
			            HTMLid: rootNode._id,
			            children: children
			        }
		        };

		        // do our logic stuff here
		        $(document).ready(function() {
			        console.log("ready!");
			        new Treant( chart_config );

			        // initialise the context menu for clicks on the tree
			        $.contextMenu({
				        // define which elements trigger this menu
				        selector: ".node",
				        trigger: 'left',
				        // define the elements of the menu
				        items: {
					        view: {name: "view samples", callback: function(key, opt) {
						        console.log("view! " + opt.$trigger.attr("id"));
						        // set table data (I know! Very nested. Will reorganise)
						        getAllNodes(function(nodes) {
						            for (i=0; i<nodes.length; i++) {
						                if (opt.$trigger.attr("id") == nodes[i]._id) {
						                    getNodeSamples(nodes[i]._id, function(samples) {
							                    $("#samples-table").tabulator("setData", samples);
							                });
							            }
							        }
							    });
					        }},
					        edit: {name: "edit", icon: "edit", callback: function(key, opt){
						        console.log("edit!");
					        }}
				        },
				        callback: function(itemKey, opt) {
					        // this is the default callback if there is no 'item' callback
					        alert("Clicked on " + itemKey + " on element " + opt.$trigger.attr("id"));
				        }
			        });
                    
                    // initialise the samples table columns (only id for now)
                    getProcessAttributeNames("rootNode", function(attributeNames) {
			            $("#samples-table").tabulator({
				            height:"320px", // set height of table (optional)
				            fitColumns:true, //fit columns to width of table (optional)
				            columns:[ //Define Table Columns
					            {title:"Id", field: "id", sorter:"string", width:150}
				            ],
				            rowClick:function(e, id, data, row){ //trigger an alert message when the row is clicked
					            alert("Row " + id + " Clicked!!!!");
				            },
			            });
			        });
		        });
            });
        });

	    </script>



	</body>

</html>
